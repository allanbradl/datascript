#!/bin/sh

mlslog="/home/ubuntu/log/mlslog.txt"
rm -rf /mls/tmp/picture/*
ftp_site='hyu1076950001.my3w.com'
passwd='ftpmaplecity8888'
username='hyu1076950001'
remote="/htdocs/mlspic/resi"
echo "`date`:Get list of Remote DIR" >>$mlslog
#lftp -u $username,$passwd $ftp_site -e " cd $remote;ls  picture ;exit" |awk '{print $9}' > /tmp/remotedir
ssh root@ali:/root/script/getremotedir.sh
scp root@ali:/tmp/remotedir /tmp/remotedir

echo "`date`: Remote Picture Dir -`wc -l /tmp/remotedir`" >>$mlslog

#check resi picture and get list of missing picture

cd  /mls/172.30.0.108/resi/picture/

ls | while read line
do

dir=$line
dir1=`echo $dir | sed 's/Photo//'`
grep $dir1 /tmp/remotedir
if [ $? = 1 ]
then
	echo "$dir doesn't exist"
	cp -r $dir /mls/tmp/picture
fi
done

#Check missing condo pictures
cd  /mls/172.30.0.108/condo/picture/

ls | while read line
do

dir=$line
dir1=`echo $dir | sed 's/Photo//'`
grep $dir1 /tmp/remotedir
if [ $? = 1 ]
then
        echo "$dir doesn't exist"
        cp -r $dir /mls/tmp/picture
fi
done


#tar PIC file
cd /mls/tmp/picture
echo "`date`: Incremental Picture Dir for SYNC-`ls |wc -l `" >>$mlslog
tar cvf /tmp/pic.tar ./*

#Get picture list from maplecity


echo "`date`: Start SCP Pic TAR to Remote Server" >>$mlslog
scp /tmp/pic.tar root@alius:/mls/resi/pic.tar 
sleep 10
echo "`date`: Complete SCP Pic TAR to Remote Server" >>$mlslog

ssh root@alius /root/script/ftpic.sh

echo "`date` : Picture SYNC is completed" >>$mlslog

#export CSV and load into MapleCity
/home/ubuntu/script/export_ali.sh
echo "`date` : Maplecity Resi DB load is completed" >>$mlslog
/home/ubuntu/script/export_condo.sh
echo "`date` : Maplecity Condo DB load is completed" >>$mlslog

#
